<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="/style.css">
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
  <title>Telegram Bot Guide</title>
</head>

<h3>

  <!-- <h1>
    << 이번 주 모임 공지>></h1>
  <h3>@ 일정 : 금요일 저녁7시 / 큰 개념 숙지 해 올 것</h3>

  <ol>
    <li>텔레그램 봇이 무엇인지, 어떻게 사용하는지(만드는 방법)</li>
    <li>라즈베리파이 Web_Server 구축과 동작 메커니즘</li>
    <li>RSS Feed란 무엇이며 RSS Reader 어떤 것을 사용하는 것이 좋을지</li>
    <li>각자 개발환경, 툴 사용할 것 알아오기.</li>
  </ol> -->


  <h3>- 참고사이트</h3>
  <ul>
    <li>
      <a href="https://steemit.com/kr-dev/@maanya/30">
        [챗봇 만들기] 30분 만에 텔레그램 봇 만들기
      </a>
    </li>
  </ul>

  <h3>- 라즈베리파이 원격 정보</h3>
  <div>IP/PORT: 14.47.253.134:22</div>
  <div>ID : skyim</div>
  <div>Password :Passw0rd</div>

  <h3>- 파일리스트</h3>
  <div id='fileList'>

  </div>

  </body>

  <script>
    var selectedList = [];
    var osType;
    var OSTYPE_WINDOWS = 1
    var OSTYPE_LINUX = 2

    $(document).ready(function () {
      $.post('osInfo', (os) => {
        if (os.platform.slice(0, 3) == 'win') {
          osType = OSTYPE_WINDOWS
          rendering('C:\\');
        } else {
          osType = OSTYPE_LINUX
          rendering('/');
        }
      })
    })

    function rendering(path) {
      $('button').remove();
      $('#fileList').children().remove();
      $(document).off('mouseenter', '#fileList p');
      selectedList = [];

      var arrPathWin = path.split('\\');
      $('#fileList').prepend(`<h3>${path}</3>`)
      console.log(arrPath);

      if (arrPathWin.length > 2 && osType === OSTYPE_WINDOWS) {
        $('#fileList').append($(`<p class="isFile">.</p>`).data('fileName', 'root').click(e => {
          rendering('C:\\');
        }));
        $('#fileList').append($(`<p class="isFile">..</p>`).data('fileName', 'upper').click(e => {
          rendering(arrPathWin.slice(0, arrPathWin.length - 2).join('\\') + '\\');
        }));
      }elseif(osType === OSTYPE_WINDOWS){
        $('#fileList').append($(`<p class="isFile">.</p>`).data('fileName', 'root').click(e => {
          rendering('C:\\');
        }));
        $('#fileList').append($(`<p class="isFile">..</p>`).data('fileName', 'upper').click(e => {
          rendering(arrPathWin.slice(0, arrPathWin.length - 2).join('\\') + '\\');
        }));
      }

      $.post('/fileList', { path: path }, function (data) {
        console.log(data);
        if (data.err) {
          console.log(data.err);
          alert(`${data.err.code}: permission denied, scandir ${path}`);
          rendering(osType === OSTYPE_WINDOWS ? 'C:\\' : '/');
        } else {
          data.forEach((val, idx, arr) => {
            var file = $(`<p class="isFile">${val.fileName}</p>`).data('fileName', val.fileName);
            var folder = $(`<p>${val.fileName}</p>`).data('fileName', val.fileName);
            $('#fileList').append(val.isDirectory ? folder : file);
          });
        }
      });

      $('#fileList').click(e => {
        if ($(e.target).hasClass('selected')) {
          $(e.target).removeClass('selected');
          selectedList.pop($(e.target).text());
        } else {
          $(e.target).addClass('selected');
          selectedList.push($(e.target).text());
        }
      });

      $(document).on('mouseenter', '#fileList p', e => {
        //console.log(path);
        var folder = $(`<button>`).text("폴더열기").click(function () {
          rendering(`${path}${$(e.target).data("fileName")}${osType === OSTYPE_WINDOWS ? '\\' : '/'}`);
        });
        var file = $(`<button>`).text("파일열기").click(function () {
        });

        if ($(e.target).hasClass('isFile')) {
          //file.appendTo(e.target);
        } else {
          folder.appendTo(e.target);
        }
      });

      $(document).on('mouseleave', '#fileList p', e => {
        $('button').remove()
      });
    }

  </script>

</html>